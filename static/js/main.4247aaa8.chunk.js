(this["webpackJsonpreact-mmd-viewer"]=this["webpackJsonpreact-mmd-viewer"]||[]).push([[0],{259:function(e){e.exports=JSON.parse('{"b":"react-mmd-viewer","a":{"name":"negimasato","email":"nishimasa.subaru@gmail.com"},"c":"0.6.0"}')},276:function(e,t,n){},379:function(e,t,n){},394:function(e,t){},395:function(e,t){},403:function(e,t){},406:function(e,t){},407:function(e,t){},409:function(e,t,n){"use strict";n.r(t);var r=n(1),a=n.n(r),i=n(55),o=n.n(i),s=(n(379),n(6)),c=n.n(s),l=n(13),u=n(7),d=n(259),h=(n(276),n(442)),p=n(467),f=n(355),m=n(458),b=n(459),A=n(460),x=n(461),g=n(205),v=n(412),j=n(356),O=n(462),y=n(463),C=n(457),w=n(351),k=n.n(w),M=n(352),B=n.n(M),I=n(353),S=n.n(I),E=n(464),R=n(200),F=n(9),T=n(265),D=n(266),P=function(){function e(e){F.Loader.call(this,e),this.loader=new F.FileLoader(this.manager),this.parser=null,this.fileArray=[],this.meshBuilder=new n(this.manager),this.animationBuilder=new o}e.prototype=Object.assign(Object.create(F.Loader.prototype),{constructor:e,setAnimationPath:function(e){return this.animationPath=e,this},readFileAsDataURL:function(){var e=Object(l.a)(c.a.mark((function e(t){var n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e){var n=new FileReader;n.onload=function(t){return e(n.result)},n.readAsDataURL(t)}));case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),getFilesFromDir:function(){var e=Object(l.a)(c.a.mark((function e(t,n){var r,a,i,o,s,l,d,h,p,f,m;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=!0,a=!1,e.prev=2,o=Object(R.a)(t);case 4:return e.next=6,o.next();case 6:return s=e.sent,r=s.done,e.next=10,s.value;case 10:if(l=e.sent,r){e.next=28;break}if(d=l,h=Object(u.a)(d,2),p=h[0],"file"!==(f=h[1]).kind){e.next=22;break}return e.next=16,f.getFile();case 16:return m=e.sent,e.next=19,this.readFileAsDataURL(m);case 19:this.fileArray[n+p]=e.sent,e.next=25;break;case 22:if("directory"!==f.kind){e.next=25;break}return e.next=25,this.getFilesFromDir(f,f.name+"\\");case 25:r=!0,e.next=4;break;case 28:e.next=34;break;case 30:e.prev=30,e.t0=e.catch(2),a=!0,i=e.t0;case 34:if(e.prev=34,e.prev=35,r||null==o.return){e.next=39;break}return e.next=39,o.return();case 39:if(e.prev=39,!a){e.next=42;break}throw i;case 42:return e.finish(39);case 43:return e.finish(34);case 44:case"end":return e.stop()}}),e,this,[[2,30,34,44],[35,,39,43]])})));return function(t,n){return e.apply(this,arguments)}}(),loadFromDir:function(){var e=Object(l.a)(c.a.mark((function e(t,n,r,a){var i,o,s,l,d,h,p,f,m,b,A,x,g,v,j=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=this.meshBuilder.setCrossOrigin(this.crossOrigin),e.next=3,this.getFilesFromDir(t,"");case 3:o=!0,s=!1,e.prev=5,d=Object(R.a)(t);case 7:return e.next=9,d.next();case 9:return h=e.sent,o=h.done,e.next=13,h.value;case 13:if(p=e.sent,o){e.next=32;break}if(f=p,m=Object(u.a)(f,2),b=m[0],A=m[1],"pmx"!==(x=this._extractExtension(b).toLowerCase())){e.next=24;break}return e.next=20,A.getFile();case 20:g=e.sent,this.loadPMXFromFile(g,(function(e){n(i.buildDir(e,j.fileArray,null,null))})),e.next=29;break;case 24:if("pmd"!==x){e.next=29;break}return e.next=27,A.getFile();case 27:v=e.sent,this.loadPMDFromFile(v,(function(e){n(i.buildDir(e,j.fileArray,null,null))}));case 29:o=!0,e.next=7;break;case 32:e.next=38;break;case 34:e.prev=34,e.t0=e.catch(5),s=!0,l=e.t0;case 38:if(e.prev=38,e.prev=39,o||null==d.return){e.next=43;break}return e.next=43,d.return();case 43:if(e.prev=43,!s){e.next=46;break}throw l;case 46:return e.finish(43);case 47:return e.finish(38);case 48:case"end":return e.stop()}}),e,this,[[5,34,38,48],[39,,43,47]])})));return function(t,n,r,a){return e.apply(this,arguments)}}(),loadFile:function(){var e=Object(l.a)(c.a.mark((function e(t,n,r,a,i){var o,s,u=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.fileArray=[],e.next=3,this.getFilesFromDir(n,"");case 3:if("pmd"===(o=this._extractExtension(t.name).toLowerCase())||"pmx"===o){e.next=7;break}return i&&i(new Error("THREE.MMDLoader: Unknown model file extension ."+o+".")),e.abrupt("return");case 7:s=this.meshBuilder.setCrossOrigin(this.crossOrigin),this["pmd"===o?"loadPMDFromFile":"loadPMXFromFile"](t,function(){var e=Object(l.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r(s.buildDir(t,u.fileArray,null,null),a,i);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a,i);case 9:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a,i){return e.apply(this,arguments)}}(),load:function(e,t,n,r){var a,i=this.meshBuilder.setCrossOrigin(this.crossOrigin);a=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:F.LoaderUtils.extractUrlBase(e);var o=this._extractExtension(e).toLowerCase();"pmd"===o||"pmx"===o?this["pmd"===o?"loadPMD":"loadPMX"](e,(function(e){t(i.build(e,a,n,r))}),n,r):r&&r(new Error("THREE.MMDLoader: Unknown model file extension ."+o+"."))},loadAnimation:function(e,t,n,r,a){var i=this.animationBuilder;this.loadVMD(e,(function(e){n(t.isCamera?i.buildCameraAnimation(e):i.build(e,t))}),r,a)},loadWithAnimation:function(e,t,n,r,a){var i=this;this.load(e,(function(e){i.loadAnimation(t,e,(function(t){n({mesh:e,animation:t})}),r,a)}),r,a)},loadPMD:function(e,t,n,r){var a=this._getParser();this.loader.setMimeType(void 0).setPath(this.path).setResponseType("arraybuffer").setRequestHeader(this.requestHeader).setWithCredentials(this.withCredentials).load(e,(function(e){t(a.parsePmd(e,!0))}),n,r)},loadPMDFromFile:function(e,t,n,r){var a=this._getParser(),i=new FileReader;i.onload=function(){t(a.parsePmd(i.result,!0))},i.readAsArrayBuffer(e)},loadPMX:function(e,t,n,r){var a=this._getParser();this.loader.setMimeType(void 0).setPath(this.path).setResponseType("arraybuffer").setRequestHeader(this.requestHeader).setWithCredentials(this.withCredentials).load(e,(function(e){t(a.parsePmx(e,!0))}),n,r)},loadPMXFromFile:function(e,t,n,r){var a=this._getParser(),i=new FileReader;i.onload=function(){t(a.parsePmx(i.result,!0))},i.readAsArrayBuffer(e)},loadVMD:function(e,t,n,r){var a=Array.isArray(e)?e:[e],i=[],o=a.length,s=this._getParser();this.loader.setMimeType(void 0).setPath(this.animationPath).setResponseType("arraybuffer").setRequestHeader(this.requestHeader).setWithCredentials(this.withCredentials);for(var c=0,l=a.length;c<l;c++)this.loader.load(a[c],(function(e){i.push(s.parseVmd(e,!0)),i.length===o&&t(s.mergeVmds(i))}),n,r)},loadVPD:function(e,t,n,r,a){var i=this._getParser();this.loader.setMimeType(t?void 0:"text/plain; charset=shift_jis").setPath(this.animationPath).setResponseType("text").setRequestHeader(this.requestHeader).setWithCredentials(this.withCredentials).load(e,(function(e){n(i.parseVpd(e,!0))}),r,a)},loadVPDFromFile:function(e,t,n,r){var a=this._getParser(),i=new FileReader;i.onload=function(){t(a.parseVpd(i.result,!0))},i.onprogress=function(e){n(e)},i.onerror=function(e){r(e)},i.readAsText(e,"Shift_JIS")},_extractExtension:function(e){var t=e.lastIndexOf(".");return t<0?"":e.slice(t+1)},_getParser:function(){if(null===this.parser){if("undefined"===typeof D.a)throw new Error("THREE.MMDLoader: Import MMDParser https://github.com/takahirox/mmd-parser");this.parser=new D.a.Parser}return this.parser}});var t=["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAN0lEQVRYR+3WQREAMBACsZ5/bWiiMvgEBTt5cW37hjsBBAgQIECAwFwgyfYPCCBAgAABAgTWAh8aBHZBl14e8wAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAOUlEQVRYR+3WMREAMAwDsYY/yoDI7MLwIiP40+RJklfcCCBAgAABAgTqArfb/QMCCBAgQIAAgbbAB3z/e0F3js2cAAAAAElFTkSuQmCC","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAN0lEQVRYR+3WQREAMBACsZ5/B5ilMvgEBTt5cW37hjsBBAgQIECAwFwgyfYPCCBAgAABAgTWAh81dWyx0gFwKAAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAOklEQVRYR+3WoREAMAwDsWb/UQtCy9wxTOQJ/oQ8SXKKGwEECBAgQIBAXeDt7f4BAQQIECBAgEBb4AOz8Hzx7WLY4wAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABPUlEQVRYR+1XwW7CMAy1+f9fZOMysSEOEweEOPRNdm3HbdOyIhAcklPrOs/PLy9RygBALxzcCDQFmgJNgaZAU6Ap0BR4PwX8gsRMVLssMRH5HcpzJEaWL7EVg9F1IHRlyqQohgVr4FGUlUcMJSjcUlDw0zvjeun70cLWmneoyf7NgBTQSniBTQQSuJAZsOnnaczjIMb5hCiuHKxokCrJfVnrctyZL0PkJAJe1HMil4nxeyi3Ypfn1kX51jpPvo/JeCNC4PhVdHdJw2XjBR8brF8PEIhNVn12AgP7uHsTBguBn53MUZCqv7Lp07Pn5k1Ro+uWmUNn7D+M57rtk7aG0Vo73xyF/fbFf0bPJjDXngnGocDTdFhygZjwUQrMNrDcmZlQT50VJ/g/UwNyHpu778+yW+/ksOz/BFo54P4AsUXMfRq7XWsAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAACMElEQVRYR+2Xv4pTQRTGf2dubhLdICiii2KnYKHVolhauKWPoGAnNr6BD6CvIVaihYuI2i1ia0BY0MZGRHQXjZj/mSPnnskfNWiWZUlzJ5k7M2cm833nO5Mziej2DWWJRUoCpQKlAntSQCqgw39/iUWAGmh37jrRnVsKlgpiqmkoGVABA7E57fvY+pJDdgKqF6HzFCSADkDq+F6AHABtQ+UMVE5D7zXod7fFNhTEckTbj5XQgHzNN+5tQvc5NG7C6BNkp6D3EmpXHDR+dQAjFLchW3VS9rlw3JBh+B7ys5Cf9z0GW1C/7P32AyBAOAz1q4jGliIH3YPuBnSfQX4OGreTIgEYQb/pBDtPnEQ4CivXYPAWBk13oHrB54yA9QuSn2H4AcKRpEILDt0BUzj+RLR1V5EqjD66NPRBVpLcQwjHoHYJOhsQv6U4mnzmrIXJCFr4LDwm/xBUoboG9XX4cc9VKdYoSA2yk5NQLJaKDUjTBoveG3Z2TElTxwjNK4M3LEZgUdDdruvcXzKBpStgp2NPiWi3ks9ZXxIoFVi+AvHLdc9TqtjL3/aYjpPlrzOcEnK62Szhimdd7xX232zFDTgtxezOu3WNMRLjiKgjtOhHVMd1loynVHvOgjuIIJMaELEqhJAV/RCSLbWTcfPFakFgFlALTRRvx+ok6Hlp/Q+v3fmx90bMyUzaEAhmM3KvHlXTL5DxnbGf/1M8RNNACLL5MNtPxP/mypJAqcDSFfgFhpYqWUzhTEAAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII="];function n(e){this.geometryBuilder=new a,this.materialBuilder=new i(e)}function r(e){var t,n,r,a,i=e.geometry,o=[];if(i&&void 0!==i.bones){for(r=0,a=i.bones.length;r<a;r++)n=i.bones[r],t=new F.Bone,o.push(t),t.name=n.name,t.position.fromArray(n.pos),t.quaternion.fromArray(n.rotq),void 0!==n.scl&&t.scale.fromArray(n.scl);for(r=0,a=i.bones.length;r<a;r++)-1!==(n=i.bones[r]).parent&&null!==n.parent&&void 0!==o[n.parent]?o[n.parent].add(o[r]):e.add(o[r])}return e.updateMatrixWorld(!0),o}function a(){}function i(e){this.manager=e,this.textureLoader=new F.TextureLoader(this.manager),this.tgaLoader=null}function o(){}function s(e,t,n,r,a){F.Interpolant.call(this,e,t,n,r),this.interpolationParams=a}return n.prototype={constructor:n,crossOrigin:"anonymous",setCrossOrigin:function(e){return this.crossOrigin=e,this},build:function(e,t,n,a){var i=this.geometryBuilder.build(e),o=this.materialBuilder.setCrossOrigin(this.crossOrigin).setResourcePath(t).build(e,i,n,a),s=new F.SkinnedMesh(i,o),c=new F.Skeleton(r(s));return s.bind(c),s},buildDir:function(e,t,n,a){var i=this.geometryBuilder.build(e);console.log(i);var o=this.materialBuilder.setCrossOrigin(this.crossOrigin).setResourceDir(t).build(e,i,n,a),s=new F.SkinnedMesh(i,o),c=new F.Skeleton(r(s));return s.bind(c),s}},a.prototype={constructor:a,build:function(e){for(var t=[],n=[],r=[],a=[],i=[],o=[],s=[],c=[],l=[],u=[],d=[],h=[],p=[],f=[],m=0,b={},A=0;A<e.metadata.vertexCount;A++){for(var x=e.vertices[A],g=0,v=x.position.length;g<v;g++)t.push(x.position[g]);for(g=0,v=x.normal.length;g<v;g++)r.push(x.normal[g]);for(g=0,v=x.uv.length;g<v;g++)n.push(x.uv[g]);for(g=0;g<4;g++)s.push(x.skinIndices.length-1>=g?x.skinIndices[g]:0);for(g=0;g<4;g++)c.push(x.skinWeights.length-1>=g?x.skinWeights[g]:0)}for(A=0;A<e.metadata.faceCount;A++){var j=e.faces[A];for(g=0,v=j.indices.length;g<v;g++)a.push(j.indices[g])}for(A=0;A<e.metadata.materialCount;A++){var O=e.materials[A];i.push({offset:3*m,count:3*O.faceCount}),m+=O.faceCount}for(A=0;A<e.metadata.rigidBodyCount;A++){var y=e.rigidBodies[A],C=b[y.boneIndex];C=void 0===C?y.type:Math.max(y.type,C),b[y.boneIndex]=C}for(A=0;A<e.metadata.boneCount;A++){-1!==(W={parent:(R=e.bones[A]).parentIndex,name:R.name,pos:R.position.slice(0,3),rotq:[0,0,0,1],scl:[1,1,1],rigidBodyType:void 0!==b[A]?b[A]:-1}).parent&&(W.pos[0]-=e.bones[W.parent].position[0],W.pos[1]-=e.bones[W.parent].position[1],W.pos[2]-=e.bones[W.parent].position[2]),o.push(W)}if("pmd"===e.metadata.format)for(A=0;A<e.metadata.ikCount;A++){var w={target:(k=e.iks[A]).target,effector:k.effector,iteration:k.iteration,maxAngle:4*k.maxAngle,links:[]};for(g=0,v=k.links.length;g<v;g++){(M={}).index=k.links[g].index,M.enabled=!0,e.bones[M.index].name.indexOf("\u3072\u3056")>=0&&(M.limitation=new F.Vector3(1,0,0)),w.links.push(M)}d.push(w)}else for(A=0;A<e.metadata.boneCount;A++){var k;if(void 0!==(k=e.bones[A].ik)){for(w={target:A,effector:k.effector,iteration:k.iteration,maxAngle:k.maxAngle,links:[]},g=0,v=k.links.length;g<v;g++){var M;if((M={}).index=k.links[g].index,M.enabled=!0,1===k.links[g].angleLimitation){var B=k.links[g].lowerLimitationAngle,I=k.links[g].upperLimitationAngle,S=-I[0],E=-I[1];I[0]=-B[0],I[1]=-B[1],B[0]=S,B[1]=E,M.rotationMin=(new F.Vector3).fromArray(B),M.rotationMax=(new F.Vector3).fromArray(I)}w.links.push(M)}d.push(w)}}if("pmx"===e.metadata.format){for(A=0;A<e.metadata.boneCount;A++){var R,T=(R=e.bones[A]).grant;if(void 0!==T){w={index:A,parentIndex:T.parentIndex,ratio:T.ratio,isLocal:T.isLocal,affectRotation:T.affectRotation,affectPosition:T.affectPosition,transformationClass:R.transformationClass};h.push(w)}}h.sort((function(e,t){return e.transformationClass-t.transformationClass}))}function D(t,n,r){for(var a=0;a<n.elementCount;a++){var i,o=n.elements[a];i="pmd"===e.metadata.format?e.morphs[0].elements[o.index].index:o.index,t.array[3*i+0]+=o.position[0]*r,t.array[3*i+1]+=o.position[1]*r,t.array[3*i+2]+=o.position[2]*r}}for(A=0;A<e.metadata.morphCount;A++){var P=e.morphs[A],L={name:P.name},Q=new F.Float32BufferAttribute(3*e.metadata.vertexCount,3);Q.name=P.name;for(g=0;g<3*e.metadata.vertexCount;g++)Q.array[g]=t[g];if("pmd"===e.metadata.format)0!==A&&D(Q,P,1);else if(0===P.type)for(g=0;g<P.elementCount;g++){var V=e.morphs[P.elements[g].index],N=P.elements[g].ratio;1===V.type&&D(Q,V,N)}else 1===P.type?D(Q,P,1):2===P.type||3===P.type||4===P.type||5===P.type||6===P.type||7===P.type||P.type;l.push(L),u.push(Q)}for(A=0;A<e.metadata.rigidBodyCount;A++){var U=e.rigidBodies[A];L={};for(var z in U)L[z]=U[z];if("pmx"===e.metadata.format&&-1!==L.boneIndex){var W=e.bones[L.boneIndex];L.position[0]-=W.position[0],L.position[1]-=W.position[1],L.position[2]-=W.position[2]}p.push(L)}for(A=0;A<e.metadata.constraintCount;A++){var H=e.constraints[A];L={};for(var z in H)L[z]=H[z];var Y=p[L.rigidBodyIndex1],K=p[L.rigidBodyIndex2];0!==Y.type&&2===K.type&&-1!==Y.boneIndex&&-1!==K.boneIndex&&e.bones[K.boneIndex].parentIndex===Y.boneIndex&&(K.type=1),f.push(L)}var _=new F.BufferGeometry;_.setAttribute("position",new F.Float32BufferAttribute(t,3)),_.setAttribute("normal",new F.Float32BufferAttribute(r,3)),_.setAttribute("uv",new F.Float32BufferAttribute(n,2)),_.setAttribute("skinIndex",new F.Uint16BufferAttribute(s,4)),_.setAttribute("skinWeight",new F.Float32BufferAttribute(c,4)),_.setIndex(a);A=0;for(var J=i.length;A<J;A++)_.addGroup(i[A].offset,i[A].count,A);return _.bones=o,_.morphTargets=l,_.morphAttributes.position=u,_.morphTargetsRelative=!1,_.userData.MMD={bones:o,iks:d,grants:h,rigidBodies:p,constraints:f,format:e.metadata.format,morphs:e.morphs,frames:e.frames,modelName:e.metadata.modelName,englishModelName:e.metadata.englishModelName,comment:e.metadata.comment,englishComment:e.metadata.englishComment},_.computeBoundingSphere(),_}},i.prototype={constructor:i,crossOrigin:"anonymous",resourcePath:void 0,resourceDir:void 0,setCrossOrigin:function(e){return this.crossOrigin=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setResourceDir:function(e){return this.resourceDir=e,this},build:function(e,t){var n=[],r={};this.textureLoader.setCrossOrigin(this.crossOrigin);for(var a=0;a<e.metadata.materialCount;a++){var i=e.materials[a],o={userData:{}};if(void 0!==i.name&&(o.name=i.name),o.color=(new F.Color).fromArray(i.diffuse),o.opacity=i.diffuse[3],o.emissive=(new F.Color).fromArray(i.ambient),o.transparent=1!==o.opacity,o.skinning=t.bones.length>0,o.morphTargets=t.morphTargets.length>0,o.fog=!0,o.blending=F.CustomBlending,o.blendSrc=F.SrcAlphaFactor,o.blendDst=F.OneMinusSrcAlphaFactor,o.blendSrcAlpha=F.SrcAlphaFactor,o.blendDstAlpha=F.DstAlphaFactor,"pmx"===e.metadata.format&&1===(1&i.flag)?o.side=F.DoubleSide:o.side=1===o.opacity?F.FrontSide:F.DoubleSide,"pmd"===e.metadata.format){if(i.fileName){var s=i.fileName.split("*");if(o.map=this._loadTexture(s[0],r),s.length>1){var c=s[1].slice(-4).toLowerCase();o.envMap=this._loadTexture(s[1],r),o.combine=".sph"===c?F.MultiplyOperation:F.AddOperation}}var l=-1===i.toonIndex?"toon00.bmp":e.toonTextures[i.toonIndex].fileName;o.gradientMap=this._loadTexture(l,r,{isToonTexture:!0,isDefaultToonTexture:this._isDefaultToonTexture(l)}),o.userData.outlineParameters={thickness:1===i.edgeFlag?.003:0,color:[0,0,0],alpha:1,visible:1===i.edgeFlag}}else{var u;-1!==i.textureIndex&&(o.map=this._loadTexture(e.textures[i.textureIndex],r)),-1===i.envTextureIndex||1!==i.envFlag&&2!=i.envFlag||(o.envMap=this._loadTexture(e.textures[i.envTextureIndex],r),o.combine=1===i.envFlag?F.MultiplyOperation:F.AddOperation),-1===i.toonIndex||0!==i.toonFlag?(l="toon"+("0"+(i.toonIndex+1)).slice(-2)+".bmp",u=!0):(l=e.textures[i.toonIndex],u=!1),o.gradientMap=this._loadTexture(l,r,{isToonTexture:!0,isDefaultToonTexture:u}),o.userData.outlineParameters={thickness:i.edgeSize/300,color:i.edgeColor.slice(0,3),alpha:i.edgeColor[3],visible:0!==(16&i.flag)&&i.edgeSize>0}}void 0!==o.map&&(o.transparent||this._checkImageTransparency(o.map,t,a),o.emissive.multiplyScalar(.2)),n.push(new F.MeshToonMaterial(o))}if("pmx"===e.metadata.format){function d(e,t){for(var n=0,r=e.length;n<r;n++){var a=e[n];if(-1!==a.index){var i=t[a.index];i.opacity!==a.diffuse[3]&&(i.transparent=!0)}}}a=0;for(var h=e.morphs.length;a<h;a++){var p=e.morphs[a],f=p.elements;if(0===p.type)for(var m=0,b=f.length;m<b;m++){var A=e.morphs[f[m].index];8===A.type&&d(A.elements,n)}else 8===p.type&&d(f,n)}}return n},_getTGALoader:function(){if(null===this.tgaLoader){if(void 0===T.a)throw new Error("THREE.MMDLoader: Import TGALoader");this.tgaLoader=new T.a(this.manager)}return this.tgaLoader},_isDefaultToonTexture:function(e){return 10===e.length&&/toon(10|0[0-9])\.bmp/.test(e)},_loadTexture:function(e,n,r,a,i){var o,s=this;if(!0===(r=r||{}).isDefaultToonTexture){var c;try{c=parseInt(e.match(/toon([0-9]{2})\.bmp$/)[1])}catch(d){console.warn("THREE.MMDLoader: "+e+" seems like a not right default texture path. Using toon00.bmp instead."),c=0}o=t[c]}else o=this.resourceDir[e];if(void 0!==n[o])return n[o];var l=this.manager.getHandler(o);null===l&&(l=".tga"===e.slice(-4).toLowerCase()?this._getTGALoader():this.textureLoader);var u=l.load(o,(function(e){!0===r.isToonTexture&&(e.image=s._getRotatedImage(e.image),e.magFilter=F.NearestFilter,e.minFilter=F.NearestFilter),e.flipY=!1,e.wrapS=F.RepeatWrapping,e.wrapT=F.RepeatWrapping;for(var t=0;t<u.readyCallbacks.length;t++)u.readyCallbacks[t](u);delete u.readyCallbacks}),a,i);return u.readyCallbacks=[],n[o]=u,u},_getRotatedImage:function(e){var t=document.createElement("canvas"),n=t.getContext("2d"),r=e.width,a=e.height;return t.width=r,t.height=a,n.clearRect(0,0,r,a),n.translate(r/2,a/2),n.rotate(.5*Math.PI),n.translate(-r/2,-a/2),n.drawImage(e,0,0),n.getImageData(0,0,r,a)},_checkImageTransparency:function(){var e=Object(l.a)(c.a.mark((function e(t,n,r){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.readyCallbacks.push((function(e){function a(e,t){var n=e.width,r=e.height,a=Math.round(t.x*n)%n,i=Math.round(t.y*r)%r;a<0&&(a+=n),i<0&&(i+=r);var o=i*n+a;return e.data[4*o+3]}var i=void 0!==e.image.data?e.image:function(e){var t=document.createElement("canvas");t.width=e.width,t.height=e.height;var n=t.getContext("2d");return n.drawImage(e,0,0),n.getImageData(0,0,t.width,t.height)}(e.image),o=n.groups[r];(function(e,t,n){var r=e.width,i=e.height;if(e.data.length/(r*i)!==4)return!1;for(var o=0;o<n.length;o+=3){for(var s={x:0,y:0},c=0;c<3;c++){var l=n[3*o+c],u={x:t[2*l+0],y:t[2*l+1]};if(a(e,u)<253)return!0;s.x+=u.x,s.y+=u.y}if(s.x/=3,s.y/=3,a(e,s)<253)return!0}return!1})(i,n.attributes.uv.array,n.index.array.slice(o.start,o.start+o.count))&&(t.transparent=!0)}));case 1:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()},o.prototype={constructor:o,build:function(e,t){for(var n=this.buildSkeletalAnimation(e,t).tracks,r=this.buildMorphAnimation(e,t).tracks,a=0,i=r.length;a<i;a++)n.push(r[a]);return new F.AnimationClip("",-1,n)},buildSkeletalAnimation:function(e,t){function n(e,t,n){e.push(t[n+0]/127),e.push(t[n+8]/127),e.push(t[n+4]/127),e.push(t[n+12]/127)}for(var r=[],a={},i=t.skeleton.bones,o={},s=0,c=i.length;s<c;s++)o[i[s].name]=!0;for(s=0;s<e.metadata.motionCount;s++){var l=e.motions[s],u=l.boneName;void 0!==o[u]&&(a[u]=a[u]||[],a[u].push(l))}for(var d in a){var h=a[d];h.sort((function(e,t){return e.frameNum-t.frameNum}));var p=[],f=[],m=[],b=[],A=[],x=t.skeleton.getBoneByName(d).position.toArray();for(s=0,c=h.length;s<c;s++){var g=h[s].frameNum/30,v=h[s].position,j=h[s].rotation,O=h[s].interpolation;p.push(g);for(var y=0;y<3;y++)f.push(x[y]+v[y]);for(y=0;y<4;y++)m.push(j[y]);for(y=0;y<3;y++)n(b,O,y);n(A,O,3)}var C=".bones["+d+"]";r.push(this._createTrack(C+".position",F.VectorKeyframeTrack,p,f,b)),r.push(this._createTrack(C+".quaternion",F.QuaternionKeyframeTrack,p,m,A))}return new F.AnimationClip("",-1,r)},buildMorphAnimation:function(e,t){for(var n=[],r={},a=t.morphTargetDictionary,i=0;i<e.metadata.morphCount;i++){var o=e.morphs[i],s=o.morphName;void 0!==a[s]&&(r[s]=r[s]||[],r[s].push(o))}for(var c in r){var l=r[c];l.sort((function(e,t){return e.frameNum-t.frameNum}));for(var u=[],d=[],h=(i=0,l.length);i<h;i++)u.push(l[i].frameNum/30),d.push(l[i].weight);n.push(new F.NumberKeyframeTrack(".morphTargetInfluences["+a[c]+"]",u,d))}return new F.AnimationClip("",-1,n)},buildCameraAnimation:function(e){function t(e,t){e.push(t.x),e.push(t.y),e.push(t.z)}function n(e,t,n){e.push(t[4*n+0]/127),e.push(t[4*n+1]/127),e.push(t[4*n+2]/127),e.push(t[4*n+3]/127)}var r=[],a=void 0===e.cameras?[]:e.cameras.slice();a.sort((function(e,t){return e.frameNum-t.frameNum}));for(var i,o,s=[],c=[],l=[],u=[],d=[],h=[],p=[],f=[],m=[],b=new F.Quaternion,A=new F.Euler,x=new F.Vector3,g=new F.Vector3,v=0,j=a.length;v<j;v++){var O=a[v],y=O.frameNum/30,C=O.position,w=O.rotation,k=O.distance,M=O.fov,B=O.interpolation;s.push(y),x.set(0,0,-k),g.set(C[0],C[1],C[2]),A.set(-w[0],-w[1],-w[2]),b.setFromEuler(A),x.add(g),x.applyQuaternion(b),t(c,g),(i=l).push((o=b).x),i.push(o.y),i.push(o.z),i.push(o.w),t(u,x),d.push(M);for(var I=0;I<3;I++)n(h,B,I);n(p,B,3);for(I=0;I<3;I++)n(f,B,4);n(m,B,5)}return(r=[]).push(this._createTrack("target.position",F.VectorKeyframeTrack,s,c,h)),r.push(this._createTrack(".quaternion",F.QuaternionKeyframeTrack,s,l,p)),r.push(this._createTrack(".position",F.VectorKeyframeTrack,s,u,f)),r.push(this._createTrack(".fov",F.NumberKeyframeTrack,s,d,m)),new F.AnimationClip("",-1,r)},_createTrack:function(e,t,n,r,a){if(n.length>2){n=n.slice(),r=r.slice(),a=a.slice();for(var i=r.length/n.length,o=a.length/n.length,c=1,l=2,u=n.length;l<u;l++){for(var d=0;d<i;d++)if(r[c*i+d]!==r[(c-1)*i+d]||r[c*i+d]!==r[l*i+d]){c++;break}if(l>c){n[c]=n[l];for(d=0;d<i;d++)r[c*i+d]=r[l*i+d];for(d=0;d<o;d++)a[c*o+d]=a[l*o+d]}}n.length=c+1,r.length=(c+1)*i,a.length=(c+1)*o}var h=new t(e,n,r);return h.createInterpolant=function(e){return new s(this.times,this.values,this.getValueSize(),e,new Float32Array(a))},h}},s.prototype=Object.assign(Object.create(F.Interpolant.prototype),{constructor:s,interpolate_:function(e,t,n,r){var a=this.resultBuffer,i=this.sampleValues,o=this.valueSize,s=this.interpolationParams,c=e*o,l=c-o,u=r-t<.05?0:(n-t)/(r-t);if(4===o){var d=s[4*e+0],h=s[4*e+1],p=s[4*e+2],f=s[4*e+3],m=this._calculate(d,h,p,f,u);F.Quaternion.slerpFlat(a,0,i,l,i,c,m)}else if(3===o)for(var b=0;b!==o;++b){d=s[12*e+4*b+0],h=s[12*e+4*b+1],p=s[12*e+4*b+2],f=s[12*e+4*b+3],m=this._calculate(d,h,p,f,u);a[b]=i[l+b]*(1-m)+i[c+b]*m}else{d=s[4*e+0],h=s[4*e+1],p=s[4*e+2],f=s[4*e+3],m=this._calculate(d,h,p,f,u);a[0]=i[l]*(1-m)+i[c]*m}return a},_calculate:function(e,t,n,r,a){for(var i,o,s,c=.5,l=c,u=1-l,d=Math,h=0;h<15;h++){var p=(i=3*u*u*l)*e+(o=3*u*l*l)*t+(s=l*l*l)-a;if(d.abs(p)<1e-5)break;c/=2,u=1-(l+=p<0?c:-c)}return i*n+o*r+s}}),e}(),L=n(357),Q=n(47),V=n(446),N=n(468),U=n(77),z=n(466),W=n(20),H=n(2),Y=n(11),K=n(28),_=n(25),J=n(14),G=n(15),X=["\u30bb\u30f3\u30bf\u30fc","\u5de6\u8db3\uff29\uff2b","\u53f3\u8db3IK","\u5de6\u3064\u307e\u5148IK","\u53f3\u3064\u307e\u5148IK","\u4e0a\u534a\u8eab","\u9996","\u982d","\u5de6\u76ee","\u53f3\u76ee","\u4e21\u76ee","\u5de6\u80a9","\u5de6\u8155","\u5de6\u3072\u3058","\u5de6\u624b\u9996","\u53f3\u80a9","\u53f3\u8155","\u53f3\u3072\u3058","\u53f3\u624b\u9996","\u5de6\u89aa\u6307\uff11","\u5de6\u89aa\u6307\uff12","\u5de6\u4eba\u6307\uff11","\u5de6\u4eba\u6307\uff12","\u5de6\u4eba\u6307\uff13","\u5de6\u4e2d\u6307\uff11","\u5de6\u4e2d\u6307\uff12","\u5de6\u4e2d\u6307\uff13","\u5de6\u85ac\u6307\uff11","\u5de6\u85ac\u6307\uff12","\u5de6\u85ac\u6307\uff13","\u5de6\u5c0f\u6307\uff11","\u5de6\u5c0f\u6307\uff12","\u5de6\u5c0f\u6307\uff13","\u53f3\u89aa\u6307\uff11","\u53f3\u89aa\u6307\uff12","\u53f3\u4eba\u6307\uff11","\u53f3\u4eba\u6307\uff12","\u53f3\u4eba\u6307\uff13","\u53f3\u4e2d\u6307\uff11","\u53f3\u4e2d\u6307\uff12","\u53f3\u4e2d\u6307\uff13","\u53f3\u85ac\u6307\uff11","\u53f3\u85ac\u6307\uff12","\u53f3\u85ac\u6307\uff13","\u53f3\u5c0f\u6307\uff11","\u53f3\u5c0f\u6307\uff12","\u53f3\u5c0f\u6307\uff13","\u4e0b\u534a\u8eab","\u5de6\u8db3","\u5de6\u3072\u3056","\u5de6\u8db3\u9996","\u53f3\u8db3","\u53f3\u3072\u3056","\u53f3\u8db3\u9996"],q=function(e){Object(J.a)(n,e);var t=Object(G.a)(n);function n(e){var r;Object(H.a)(this,n),(r=t.call(this)).mesh=void 0,r.mesh=e,r.matrix.copy(e.matrixWorld).invert();var a,i=new F.SphereGeometry(.1,16,8),o=new F.MeshBasicMaterial({color:new F.Color(6579455),depthTest:!1,depthWrite:!1,transparent:!0}),s=(r.mesh.geometry.userData.MMD,0),c=Object(W.a)(r.mesh.skeleton.bones);try{for(c.s();!(a=c.n()).done;){var l=a.value,u=new F.Mesh(i,o);if(X.indexOf(l.name)>-1){u.name="Helper id:"+s,u.userData={bone_id:s};var d=r.getPosition(l,r.matrix);u.position.set(d.x,d.y,d.z),r.mesh.add(u)}s++}}catch(h){c.e(h)}finally{c.f()}return r.matrixAutoUpdate=!0,r}return Object(Y.a)(n,[{key:"updateMatrixWorld",value:function(e){this.matrix.copy(this.mesh.matrixWorld).invert();var t,r=0,a=Object(W.a)(this.mesh.children);try{for(a.s();!(t=a.n()).done;){var i=t.value;if(0!==r){if("Mesh"===i.type&&null!=i.userData.bone_id){var o=this.mesh.skeleton.bones[i.userData.bone_id];if(!o)continue;var s=this.getPosition(o,this.matrix);i.position.copy(s),i.visible=this.visible}r++}else r++}}catch(c){a.e(c)}finally{a.f()}this.matrix.copy(this.mesh.matrixWorld),Object(K.a)(Object(_.a)(n.prototype),"updateMatrixWorld",this).call(this,e)}},{key:"getPosition",value:function(e,t){return(new F.Vector3).setFromMatrixPosition(e.matrixWorld).applyMatrix4(t)}}]),n}(F.Object3D),Z=n(22);var $,ee,te=function(e){var t=Object(r.useRef)(),n=Object(r.useRef)(),a=new F.Raycaster,i=Object(U.e)(),o=i.scene,s=i.mouse,c=i.camera,l=Object(r.useState)(null),d=Object(u.a)(l,2),h=d[0],p=d[1],f=Object(r.useState)(0),m=Object(u.a)(f,2),b=m[0],A=m[1],x=Object(r.useCallback)((function(e){"Mesh"===e.object.type&&A((function(t){return e.object.userData.bone_id}))}),[]);return Object(U.d)((function(){if(null!=t.current&&e.activeModelIndex==e.index){a.setFromCamera(s,c);var n=a.intersectObjects(t.current.children[0].children);if(n.length>0)for(var r=0;r<n.length;r++){var i=n[r].object.userData.bone_id,o=t.current.children[0].geometry.userData.MMD.bones[i].name;e.setLabelText(o),e.setIsShowLabel(!0)}else e.setIsShowLabel(!1)}})),Object(r.useLayoutEffect)((function(){if("undefined"!==typeof n.current){var r=n.current,a=function(t){e.orbit.current&&(e.orbit.current.enabled=!t.value)};if(r){if(e.activeModelIndex==e.index){var i;if(!t.current||!t.current.children)return;var s=null===(i=t.current)||void 0===i?void 0:i.children[0];if(!s)return;if(r.attach(s.skeleton.bones[b]),e.isShowBoneSelect){if(s)if(null==h){var c=new q(s);o.add(c),p(c)}else h.visible=!0}else h&&(h.visible=!1);""!=e.controlMode?r.setMode(e.controlMode):r.detach()}else r.detach(),null!=h&&(h.visible=!1);return r.addEventListener("dragging-changed",a),function(){r.removeEventListener("dragging-changed",a)}}}})),Object(Z.jsx)(Z.Fragment,{children:e.activeModelIndex==e.index?Object(Z.jsx)(z.a,{ref:n,enabled:!0,children:Object(Z.jsx)("mesh",{ref:t,onClick:x,children:Object(Z.jsx)("primitive",{object:e.modelClass.mesh,dispose:null,scale:[.5,.5,.5],position:e.position})})}):Object(Z.jsx)("mesh",{ref:t,onClick:x,children:Object(Z.jsx)("primitive",{object:e.modelClass.mesh,dispose:null,scale:[.5,.5,.5],position:e.position})})})},ne=n(268),re=n(269);function ae(e){return Object(Z.jsx)(Z.Fragment,{children:Object(Z.jsx)(oe,{style:{top:e.top+5,left:e.left+5},children:e.text})})}var ie=Object(re.a)($||($=Object(ne.a)(["\n  position: absolute;\n  pointer-events: none;\n  user-select: none;\n  color: black;\n  background-color: white;\n  z-index:100000;\n"]))),oe=re.b.div(ee||(ee=Object(ne.a)(["\n  ","\n  top: 100px;\n  left: 10px;\n  font-size: 2em;\n  pointer-events: all;\n  @media only screen and (max-width: 900px) {\n    font-size: 1.5em;\n  }\n"])),ie),se={dirHandle:null,setDirHandle:function(){},models:[],setModels:function(){},activeModelIndex:-1,setactiveModelIndex:function(){},editMode:"model",setEditMode:function(){},fov:30,setFov:function(){}},ce=Object(r.createContext)(se),le=n(444),ue=n(328),de=n.n(ue),he=n(329),pe=n.n(he),fe=Object(h.a)((function(e){return Object(p.a)({position:{position:"absolute",zIndex:1,right:10}})}));function me(e){var t=new F.Vector2,n=new F.Vector2,a=new F.Vector2,i=fe(),o=Object(r.useRef)(),s=Object(r.useRef)(),c=function(e,t){var n=new F.Vector3;return n.setFromMatrixColumn(t,0),n.multiplyScalar(-e),n},l=function(e,t){var n=new F.Vector3;return n.setFromMatrixColumn(t,1),n.multiplyScalar(e),n};return Object(Z.jsxs)(Z.Fragment,{children:[Object(Z.jsx)(le.a,{ref:o,size:"small",color:"primary",className:i.position,style:{top:50},onMouseDown:function(e){var t;null===(t=o.current)||void 0===t||t.requestPointerLock()},onMouseUp:function(e){window.document.exitPointerLock()},onMouseMove:function(t){if(window.document.pointerLockElement){var n=e.orbit;if(n){var r,a=null===(r=n.current)||void 0===r?void 0:r.object;a&&a.translateZ(t.movementY)}}},children:Object(Z.jsx)(de.a,{})}),Object(Z.jsx)(le.a,{ref:s,size:"small",color:"primary",className:i.position,style:{top:100},onMouseDown:function(e){var n;null===(n=s.current)||void 0===n||n.requestPointerLock(),t.set(e.clientX,e.clientY)},onMouseUp:function(e){window.document.exitPointerLock()},onMouseMove:function(r){if(window.document.pointerLockElement){var i=e.orbit;if(i){var o=i.current,s=o.object,u=o.domElement,d=o.panSpeed;if(o&&o.object){n.set(t.x+r.movementX,t.y+r.movementY),a.subVectors(n,t).multiplyScalar(d);var h=o.target,p=new F.Vector3;if(h){var f=s.position;p.copy(f).sub(h);var m=p.length();m*=Math.tan(s.fov/2*Math.PI/180);var b=new F.Vector3;b.add(c(2*a.x*m/u.clientWidth,s.matrix)),b.add(l(2*a.y*m/u.clientHeight,s.matrix)),t.copy(n),h.add(b),(f=o.object.position).copy(h).add(p)}}}}},children:Object(Z.jsx)(pe.a,{})})]})}function be(e){var t=Object(r.useRef)(),n=Object(U.e)().setDefaultCamera;return Object(r.useEffect)((function(){if(t&&t.current){var r=t.current;r.fov!=e.fov&&(r.fov=e.fov,r.updateProjectionMatrix()),n(r)}})),Object(Z.jsx)("perspectiveCamera",{ref:t,position:[0,10,30]})}var Ae=function(e){var t=Object(r.useState)([0,0]),n=Object(u.a)(t,2),a=n[0],i=n[1],o=Object(r.useState)(""),s=Object(u.a)(o,2),c=s[0],l=s[1],d=Object(r.useState)(!0),h=Object(u.a)(d,2),p=h[0],f=h[1],m=Object(r.useRef)(),b=Object(r.useCallback)((function(e){i([e.clientY,e.clientX])}),[]),A=Object(r.useContext)(ce);return Object(Z.jsxs)("div",{children:[p?Object(Z.jsx)(ae,{top:a[0],left:a[1],text:c}):null,Object(Z.jsx)(me,{orbit:m,height:350}),Object(Z.jsxs)(U.a,{className:"mainView",onMouseMove:b,style:{backgroundColor:"white",height:"350px"},colorManagement:!1,children:[Object(Z.jsx)(be,{fov:A.fov}),Object(Z.jsx)(V.a,{showPanel:0,className:"stats"}),Object(Z.jsx)("directionalLight",{intensity:.9,position:[-.5,-1,.5],castShadow:!0}),Object(Z.jsx)(r.Suspense,{fallback:null,children:A.models.map((function(t,n){return Object(r.createElement)(te,Object(Q.a)(Object(Q.a)({},e),{},{key:n,index:n,modelClass:t,position:[0,0,0],activeModelIndex:A.activeModelIndex,setLabelText:l,setIsShowLabel:f,orbit:m}))}))}),Object(Z.jsx)(N.a,{ref:m}),Object(Z.jsx)("gridHelper",{})]}),Object(Z.jsx)("div",{style:{height:"32px",width:"100%"},children:"model"===A.editMode?Object(Z.jsx)(v.a,{size:"small",onClick:function(){A.setEditMode("camera")},children:"\u30ab\u30e1\u30e9\u7de8"}):Object(Z.jsx)(v.a,{size:"small",onClick:function(){A.setEditMode("model")},children:"\u30e2\u30c7\u30eb\u7de8"})})]})},xe=n(447),ge=function(e){return Object(Z.jsxs)("div",{style:{textAlign:"center",padding:"5px"},children:[Object(Z.jsx)("p",{style:{fontSize:20,margin:"0px 0px 10px 0px"},children:"\u30dc\u30fc\u30f3\u64cd\u4f5c"}),Object(Z.jsxs)(xe.a,{fullWidth:!0,"aria-label":"button group",children:[Object(Z.jsx)(v.a,{onClick:function(){e.isShowBoneSelect?e.setIsShowBoneSelect(!1):e.setIsShowBoneSelect(!0)},children:"\u9078\u629e"}),Object(Z.jsx)(v.a,{onClick:function(){"rotate"===e.controlMode?e.setControlMode(""):e.setControlMode("rotate")},children:"\u56de\u8ee2"}),Object(Z.jsx)(v.a,{onClick:function(){"translate"===e.controlMode?e.setControlMode(""):e.setControlMode("translate")},children:"\u79fb\u52d5"})]})]})},ve=n(448),je=n(465),Oe=n(469),ye=n(470),Ce=Object(h.a)((function(e){return Object(p.a)({formControl:{margin:e.spacing(1),minWidth:120},selectEmpty:{marginTop:e.spacing(2)}})}));function we(e){var t=Ce(),n=Object(r.useState)(-1),a=Object(u.a)(n,2),i=a[0],o=a[1];return Object(Z.jsxs)(ve.a,{variant:"filled",className:t.formControl,children:[Object(Z.jsx)(Oe.a,{id:"label",children:e.label}),Object(Z.jsxs)(je.a,{labelId:"label",style:{minWidth:150},onChange:function(t){var n=t.target.value;"string"===typeof n&&(e.handleChange(null,0,e.morphType,i),o(Number(n)))},value:i,native:!0,children:[Object(Z.jsx)("option",{value:-1},-1),e.morphs.map((function(e,t){return Object(Z.jsx)("option",{value:e.id,children:e.name},t)}))]}),Object(Z.jsx)(ye.a,{value:e.morphSliders[e.morphType],onChange:function(t,n){return e.handleChange(t,n,e.morphType,i)},"aria-labelledby":"continuous-slider",step:.001,min:0,max:1})]})}var ke=function(e){var t=Object(r.useState)([[],[],[],[]]),n=Object(u.a)(t,2),a=n[0],i=n[1],o=Object(r.useState)([0,0,0,0]),s=Object(u.a)(o,2),c=s[0],l=s[1],d=Object(r.useContext)(ce);Object(r.useEffect)((function(){if(-1!==d.activeModelIndex&&!(d.models.length<d.activeModelIndex)&&d.models[d.activeModelIndex]){var e=d.models[d.activeModelIndex].mesh;if(e&&e.morphTargetInfluences){var t,n=e.geometry.userData.MMD.morphs,r=[[],[],[],[]],a=0,o=Object(W.a)(n);try{for(o.s();!(t=o.n()).done;){var s=t.value,c={id:a,name:s.name};if(s.panel){if(s.panel<1||s.panel>4){a++;continue}r[s.panel-1].push(c)}else{if(s.type<1||s.type>4){a++;continue}r[s.type-1].push(c)}a++}}catch(l){o.e(l)}finally{o.f()}i(r)}}}),[d.models,d.activeModelIndex]);var h=function(e,t,n,r){var a=d.models[d.activeModelIndex].mesh;if(a&&a.morphTargetInfluences){a.morphTargetInfluences[r]=t;var i=c.slice();i[n]=t,l(i)}else console.error("mesh\u304cnull\u304bmorphTargetInfluences\u304cnulld\u3067\u3059")};return Object(Z.jsxs)("div",{style:{textAlign:"center"},children:[Object(Z.jsx)("p",{style:{fontSize:20,margin:"5px 0px 0px 0px"},children:"\u8868\u60c5\u64cd\u4f5c"}),Object(Z.jsxs)("div",{style:{padding:"0px 10px 10px 10px"},children:[Object(Z.jsx)(we,{label:"\u307e\u3086",morphs:a[0],morphType:0,handleChange:h,morphSliders:c}),Object(Z.jsx)(we,{label:"\u76ee",morphs:a[1],morphType:1,handleChange:h,morphSliders:c})]}),Object(Z.jsxs)("div",{style:{padding:"0px 10px 10px 10px"},children:[Object(Z.jsx)(we,{label:"\u30ea\u30c3\u30d7",morphs:a[2],morphType:2,handleChange:h,morphSliders:c}),Object(Z.jsx)(we,{label:"\u305d\u306e\u4ed6",morphs:a[3],morphType:3,handleChange:h,morphSliders:c})]})]})},Me=(n(331),n(354),n(260),n(92)),Be=n(452),Ie=n(453),Se=n(454),Ee=n(451),Re=Object(h.a)((function(e){return Object(p.a)({root:{width:"100%",maxWidth:360,backgroundColor:e.palette.background.paper},paper:{width:"80%",maxHeight:435}})}));var Fe=function(e){Re();var t=Object(r.useRef)(null),n=Object(r.useRef)(),i=e.onClose,o=e.value,s=e.open,c=Object(Me.a)(e,["onClose","value","open"]),l=a.a.useState(o),d=Object(u.a)(l,2),h=(d[0],d[1]),p=a.a.useRef(null);return a.a.useEffect((function(){var r=function(){var e=t.current;return e?e.getContext("2d"):null}();if(r&&e.value){var a=n.current,i=t.current,c=e.value,l=c.width,u=c.height;i.width=a.clientWidth;var d=i.width/l;i.height=u*d,r.setTransform(d,0,0,d,0,0),r.drawImage(c,0,0)}s||h(o)}),[o,s]),Object(Z.jsxs)(Ee.a,Object(Q.a)(Object(Q.a)({disableBackdropClick:!0,disableEscapeKeyDown:!0,maxWidth:"lg",onEntering:function(){null!=p.current&&p.current.focus()},"aria-labelledby":"confirmation-dialog-title",open:s},c),{},{children:[Object(Z.jsx)(Be.a,{id:"confirmation-dialog-title",children:"PoseNet\u30d7\u30ec\u30d3\u30e5\u30fc"}),Object(Z.jsx)(Ie.a,{dividers:!0,ref:n,children:Object(Z.jsx)("canvas",{ref:t})}),Object(Z.jsxs)(Se.a,{children:[Object(Z.jsx)(v.a,{autoFocus:!0,onClick:function(){i()},color:"primary",children:"Cancel"}),Object(Z.jsx)(v.a,{onClick:function(){},color:"primary",children:"Ok"})]})]}))},Te=n(23),De=n(413),Pe=n(455),Le=n(450),Qe=n(414),Ve=n(456),Ne=function e(){Object(H.a)(this,e),this.path=void 0,this.mesh=void 0,this.modelName=void 0,this.comment=void 0,this.path=null,this.mesh=null,this.modelName=null,this.comment=null};var Ue=function(e){var t=Object(r.useState)(!1),n=Object(u.a)(t,2),a=n[0],i=n[1],o=Object(r.useContext)(ce),s=function(){e.setOpen(!1)};return Object(Z.jsxs)(Z.Fragment,{children:[Object(Z.jsx)(De.a,{open:a,style:{zIndex:1e4,color:"#fff"},children:Object(Z.jsx)(Pe.a,{color:"inherit"})}),Object(Z.jsxs)(Ee.a,{disableBackdropClick:!0,disableEscapeKeyDown:!0,keepMounted:!0,maxWidth:"lg","aria-labelledby":"confirmation-dialog-title",open:e.open,children:[Object(Z.jsx)(Be.a,{id:"confirmation-dialog-title",children:"\u30e2\u30c7\u30eb\u9078\u629e"}),Object(Z.jsx)(Ie.a,{dividers:!0,children:Object(Z.jsx)(Le.a,{component:"div",role:"list",children:e.values.map((function(t,n){return Object(Z.jsx)(Qe.a,{button:!0,divider:!0,role:"listitem",onClick:function(t){return function(t,n){s(),i(!0),(new P).loadFile(e.values[n].file,e.values[n].rootDirHandle,(function(e){var t=new Ne;t.mesh=e;var n="\u30e2\u30c7\u30eb\u60c5\u5831:\n\n"+e.geometry.userData.MMD.comment;t.comment=n,t.modelName=o.models.length+":"+e.geometry.userData.MMD.modelName;var r=[].concat(Object(Te.a)(o.models),[t]),a=o.activeModelIndex+1;alert(t.comment),o.setModels(r),o.setactiveModelIndex(a),i(!1)}))}(0,n)},children:Object(Z.jsx)(Ve.a,{primary:t.path})},n)}))})}),Object(Z.jsx)(Se.a,{children:Object(Z.jsx)(v.a,{onClick:s,color:"secondary",children:"Cancel"})})]})]})},ze=Object(h.a)((function(e){return Object(p.a)({formControl:{margin:e.spacing(1),minWidth:200},selectEmpty:{marginTop:e.spacing(2)}})}));var We=function(e){var t=ze(),n=Object(r.useContext)(ce),i=a.a.useState(!1),o=Object(u.a)(i,2),s=o[0],d=o[1],h=a.a.useState(),p=Object(u.a)(h,2),f=p[0],m=(p[1],Object(r.useState)(!1)),b=Object(u.a)(m,2),A=b[0],x=b[1],g=Object(r.useState)([]),j=Object(u.a)(g,2),O=j[0],y=j[1];function C(e,t){return w.apply(this,arguments)}function w(){return(w=Object(l.a)(c.a.mark((function e(t,n){var r,a,i,o,s,l,d,h,p,f,m,b,A,x,g;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=[],a=!0,i=!1,e.prev=3,s=Object(R.a)(t);case 5:return e.next=7,s.next();case 7:return l=e.sent,a=l.done,e.next=11,l.value;case 11:if(d=e.sent,a){e.next=32;break}if(h=d,p=Object(u.a)(h,2),f=p[0],"file"!==(m=p[1]).kind){e.next=24;break}if(b=f.lastIndexOf("."),"pmx"!==(A=b<0?"":f.slice(b+1).toLowerCase())&&"pmd"!==A){e.next=22;break}return e.next=20,m.getFile();case 20:x=e.sent,r.push({file:x,path:n+f,rootDirHandle:t});case 22:e.next=29;break;case 24:if("directory"!==m.kind){e.next=29;break}return e.next=27,C(m,m.name+"\\");case 27:g=e.sent,r=r.concat(g);case 29:a=!0,e.next=5;break;case 32:e.next=38;break;case 34:e.prev=34,e.t0=e.catch(3),i=!0,o=e.t0;case 38:if(e.prev=38,e.prev=39,a||null==s.return){e.next=43;break}return e.next=43,s.return();case 43:if(e.prev=43,!i){e.next=46;break}throw o;case 46:return e.finish(43);case 47:return e.finish(38);case 48:return e.abrupt("return",r);case 49:case"end":return e.stop()}}),e,null,[[3,34,38,48],[39,,43,47]])})))).apply(this,arguments)}function k(){return(k=Object(l.a)(c.a.mark((function e(){var t,n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,window.showDirectoryPicker();case 3:return t=e.sent,e.next=6,C(t,"");case 6:n=e.sent,y(n),x(!0),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),console.error(e.t0);case 14:case"end":return e.stop()}}),e,null,[[0,11]])})))).apply(this,arguments)}return Object(Z.jsxs)("div",{style:{textAlign:"center"},children:[Object(Z.jsx)(Ue,{open:A,setOpen:x,values:O}),Object(Z.jsx)(Fe,{id:"ringtone-menu",keepMounted:!0,open:s,onClose:function(e){d(!1)},value:f}),Object(Z.jsx)("p",{style:{fontSize:20,margin:"5px 0px 0px 0px"},children:"\u30e2\u30c7\u30eb\u64cd\u4f5c"}),Object(Z.jsx)("div",{style:{padding:"0px 10px 10px 10px"},children:Object(Z.jsxs)(ve.a,{variant:"filled",className:t.formControl,children:[Object(Z.jsx)("div",{children:Object(Z.jsx)(je.a,{style:{width:"100%"},value:n.activeModelIndex,onChange:function(e){n.setactiveModelIndex(e.target.value)},native:!0,children:n.models.map((function(e,t){return Object(Z.jsx)("option",{value:t,children:e.modelName},t)}))})}),Object(Z.jsxs)("div",{children:[Object(Z.jsx)(v.a,{variant:"contained",style:{width:"50%"},onClick:function(){return k.apply(this,arguments)},children:"\u8aad\u307f\u8fbc\u307f"}),Object(Z.jsx)(v.a,{variant:"contained",style:{width:"50%"},onClick:function(){if(-1!==n.activeModelIndex){var e=n.models.filter((function(e,t){return t!=n.activeModelIndex})),t=e.length-1;n.setModels(e),n.setactiveModelIndex(t)}else console.warn("\u3053\u308c\u4ee5\u4e0a\u524a\u9664\u306f\u3067\u304d\u306a\u3044")},children:"\u524a\u9664"})]})]})})]})},He=function(e){return Object(Z.jsxs)(Z.Fragment,{children:[Object(Z.jsx)(C.a,{item:!0,xs:4,style:{border:"1px solid #ffffff"},children:Object(Z.jsx)(We,{},"modelcontrol")}),Object(Z.jsx)(C.a,{item:!0,xs:4,style:{border:"1px solid #ffffff"},children:Object(Z.jsx)(ge,{controlMode:e.controlMode,setControlMode:e.setControlMode,isShowBoneSelect:e.isShowBoneSelect,setIsShowBoneSelect:e.setIsShowBoneSelect},"bonecontrol")}),Object(Z.jsx)(C.a,{item:!0,xs:4,style:{border:"1px solid #ffffff"},children:Object(Z.jsx)(ke,{},"faceControl")})]})},Ye=n(449),Ke=Object(h.a)({root:{width:250},input:{width:42}}),_e=function(e){var t=Ke(),n=Object(r.useContext)(ce);return Object(Z.jsxs)("div",{style:{textAlign:"center",padding:"5px"},children:[Object(Z.jsx)("p",{style:{fontSize:20,margin:"0px 0px 10px 0px"},children:"\u30ab\u30e1\u30e9\u64cd\u4f5c"}),Object(Z.jsx)(g.a,{id:"input-slider",gutterBottom:!0,children:"\u8996\u91ce\u89d2"}),Object(Z.jsxs)(C.a,{container:!0,spacing:2,alignItems:"center",children:[Object(Z.jsx)(C.a,{item:!0,xs:!0,children:Object(Z.jsx)(ye.a,{value:"number"===typeof n.fov?n.fov:0,onChange:function(e,t){return function(e,t){"number"===typeof t&&(console.log("newValue:"+t),n.setFov(t))}(0,t)},"aria-labelledby":"input-slider",valueLabelDisplay:"auto",step:1,min:0,max:100})}),Object(Z.jsx)(C.a,{item:!0,children:Object(Z.jsx)(Ye.a,{className:t.input,value:n.fov,margin:"dense",onChange:function(e){n.setFov(Number(e.target.value))},onBlur:function(){n.fov<0?n.setFov(0):n.fov>100&&n.setFov(100)},inputProps:{step:10,min:0,max:100,type:"number","aria-labelledby":"input-slider"}})})]})]})},Je=function(e){return Object(Z.jsx)(Z.Fragment,{children:Object(Z.jsx)(C.a,{item:!0,xs:4,style:{border:"1px solid #ffffff"},children:Object(Z.jsx)(_e,{})})})},Ge=Object(h.a)((function(e){return Object(p.a)({root:{width:"100%",maxWidth:360,backgroundColor:e.palette.background.paper},paper:{width:"80%",maxHeight:435}})}));var Xe=function(){var e=Object(r.useState)([]),t=Object(u.a)(e,2),n=t[0],i=t[1],o=Object(r.useState)(0),s=Object(u.a)(o,2),h=s[0],p=(s[1],Object(r.useState)(-1)),w=Object(u.a)(p,2),M=w[0],I=w[1],R=Object(r.useState)("rotate"),F=Object(u.a)(R,2),T=F[0],D=F[1],Q=Object(r.useState)("model"),V=Object(u.a)(Q,2),N=V[0],U=V[1],z=Object(r.useState)(50),W=Object(u.a)(z,2),H=W[0],Y=W[1],K=Object(r.useState)(!1),_=Object(u.a)(K,2),J=_[0],G=_[1],X=a.a.useState(null),q=Object(u.a)(X,2),$=q[0],ee=q[1],te=a.a.useState(""),ne=Object(u.a)(te,2),re=ne[0],ae=ne[1],ie=a.a.useState("on"===localStorage.getItem("darkMode")),oe=Object(u.a)(ie,2),se=oe[0],le=oe[1],ue=Object(r.useState)(),de=Object(u.a)(ue,2),he=de[0],pe=de[1],fe=(Ge(),a.a.useState(!0)),me=Object(u.a)(fe,2),be=(me[0],me[1],a.a.useState("Dione")),xe=Object(u.a)(be,2),ge=(xe[0],xe[1],function(e,t){ee(e.currentTarget),ae(t)}),ve=function(){ee(null),ae("")},je=Object(f.a)({palette:{type:se?"dark":"light"}}),Oe=function(){var e=Object(l.a)(c.a.mark((function e(t){var r,a,i,o,s,l,d;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ee(null),ae(""),0!==n.length){e.next=5;break}return alert("\u30e2\u30c7\u30eb\u30c7\u30fc\u30bf\u304c\u3042\u308a\u307e\u305b\u3093\u3002"),e.abrupt("return");case 5:return a={types:[{description:"MMD Pose Data",accept:{"*/*":[".vpd"]}}],excludeAcceptAllOption:!0,multiple:!1},e.next=8,window.showOpenFilePicker(a);case 8:if(i=e.sent,o=Object(u.a)(i,1),r=o[0]){e.next=13;break}return e.abrupt("return");case 13:return e.next=15,r.getFile();case 15:s=e.sent,l=new P,d=new L.a,l.loadVPDFromFile(s,(function(e){var t=n[h].mesh;t?d.pose(t,e):alert("\u30e2\u30c7\u30eb\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002")}),(function(e){console.log(e)}),(function(e){console.log(e)}));case 19:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ye=function(){var e=Object(l.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:"\u3053\u308c\u306fWeb\u4e0a\u3067MMD\u3092\u8868\u793a\u3055\u305b\u308b\u4e8b\u304c\u3067\u304d\u308b\u30a2\u30d7\u30ea\u3067\u3059\u3002\n\u307e\u3060\u307b\u3068\u3093\u3069\u304c\u30c6\u30b9\u30c8\u6bb5\u968e\u3067\u3059\u306e\u3067\u3001\u591a\u304f\u306e\u554f\u984c\u304c\u3042\u308a\u307e\u3059\u3002\n\u8a66\u3059\u5834\u5408\u306f\u81ea\u5df1\u8cac\u4efb\u3067\u304a\u9858\u3044\u3057\u307e\u3059\u3002\n\u30e2\u30c7\u30eb\u30c7\u30fc\u30bf\u3092\u5229\u7528\u3059\u308b\u5834\u5408\u306f\u5fc5\u305a\u88fd\u4f5c\u8005\u306e\u5229\u7528\u898f\u7d04\u3092\u5b88\u3063\u3066\u3054\u5229\u7528\u304f\u3060\u3055\u3044\u3002\n\u6700\u65b0\u306eGoogleChrome\u3092\u3054\u5229\u7528\u304f\u3060\u3055\u3044\u3002\n\n\u3053\u306e\u30a2\u30d7\u30ea\u306e\u30bd\u30fc\u30b9\u306fGithub\u3067\u516c\u958b\u3057\u3066\u3044\u307e\u3059\u306e\u3067\u3001\u6c17\u306b\u306a\u308b\u65b9\u306f\u3054\u81ea\u7531\u306b\u3054\u89a7\u304f\u3060\u3055\u3044\u3002",alert("\u3053\u308c\u306fWeb\u4e0a\u3067MMD\u3092\u8868\u793a\u3055\u305b\u308b\u4e8b\u304c\u3067\u304d\u308b\u30a2\u30d7\u30ea\u3067\u3059\u3002\n\u307e\u3060\u307b\u3068\u3093\u3069\u304c\u30c6\u30b9\u30c8\u6bb5\u968e\u3067\u3059\u306e\u3067\u3001\u591a\u304f\u306e\u554f\u984c\u304c\u3042\u308a\u307e\u3059\u3002\n\u8a66\u3059\u5834\u5408\u306f\u81ea\u5df1\u8cac\u4efb\u3067\u304a\u9858\u3044\u3057\u307e\u3059\u3002\n\u30e2\u30c7\u30eb\u30c7\u30fc\u30bf\u3092\u5229\u7528\u3059\u308b\u5834\u5408\u306f\u5fc5\u305a\u88fd\u4f5c\u8005\u306e\u5229\u7528\u898f\u7d04\u3092\u5b88\u3063\u3066\u3054\u5229\u7528\u304f\u3060\u3055\u3044\u3002\n\u6700\u65b0\u306eGoogleChrome\u3092\u3054\u5229\u7528\u304f\u3060\u3055\u3044\u3002\n\n\u3053\u306e\u30a2\u30d7\u30ea\u306e\u30bd\u30fc\u30b9\u306fGithub\u3067\u516c\u958b\u3057\u3066\u3044\u307e\u3059\u306e\u3067\u3001\u6c17\u306b\u306a\u308b\u65b9\u306f\u3054\u81ea\u7531\u306b\u3054\u89a7\u304f\u3060\u3055\u3044\u3002");case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(Z.jsx)(m.a,{theme:je,children:Object(Z.jsxs)(ce.Provider,{value:{dirHandle:he,setDirHandle:pe,models:n,setModels:i,activeModelIndex:M,setactiveModelIndex:I,editMode:N,setEditMode:U,fov:H,setFov:Y},children:[Object(Z.jsx)(b.a,{}),Object(Z.jsx)(A.a,{color:"default",position:"static",children:Object(Z.jsxs)(x.a,{variant:"dense",children:[Object(Z.jsxs)(E.a,{display:"flex",flexGrow:1,children:[Object(Z.jsxs)(g.a,{variant:"h6",children:["React MMD Viewer ver.",d.c]}),Object(Z.jsx)(v.a,{"aria-controls":"simple-menu","aria-haspopup":"true",onClick:function(e){return ge(e,"file")},children:"File"}),Object(Z.jsx)(j.a,{id:"menu-appbar",anchorEl:$,anchorOrigin:{vertical:"top",horizontal:"right"},keepMounted:!0,transformOrigin:{vertical:"top",horizontal:"right"},open:"file"===re,onClose:ve,children:Object(Z.jsx)(O.a,{onClick:Oe,children:"\u30dd\u30fc\u30ba\u8aad\u307f\u8fbc\u307f"})})]}),Object(Z.jsx)(y.a,{"aria-label":"account of current user","aria-controls":"menu-appbar","aria-haspopup":"true",onClick:function(e){return ge(e,"info")},color:"inherit",children:Object(Z.jsx)(k.a,{})}),Object(Z.jsxs)(j.a,{id:"menu-appbar",anchorEl:$,anchorOrigin:{vertical:"top",horizontal:"right"},keepMounted:!0,transformOrigin:{vertical:"top",horizontal:"right"},open:"info"===re,onClose:ve,children:[Object(Z.jsx)(O.a,{onClick:ye,children:"About"}),Object(Z.jsx)(O.a,{onClick:function(){return window.open("https://github.com/"+d.a.name+"/"+d.b)},children:"Github"})]}),se?Object(Z.jsx)(y.a,{color:"inherit",onClick:function(){localStorage.setItem("darkMode","off"),le(!1)},children:Object(Z.jsx)(B.a,{})}):Object(Z.jsx)(y.a,{color:"inherit",onClick:function(){localStorage.setItem("darkMode","on"),le(!0)},children:Object(Z.jsx)(S.a,{})})]})}),Object(Z.jsxs)(C.a,{container:!0,children:[Object(Z.jsx)(C.a,{item:!0,xs:12,children:Object(Z.jsx)(Ae,{selectObject:h,controlMode:T,isShowBoneSelect:J})}),"model"===N?Object(Z.jsx)(He,{controlMode:T,setControlMode:D,isShowBoneSelect:J,setIsShowBoneSelect:G}):Object(Z.jsx)(Je,{})]})]})})},qe=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,472)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,i=t.getLCP,o=t.getTTFB;n(e),r(e),a(e),i(e),o(e)}))};o.a.render(Object(Z.jsx)(a.a.StrictMode,{children:Object(Z.jsx)(Xe,{})}),document.getElementById("root")),qe()}},[[409,1,2]]]);
//# sourceMappingURL=main.4247aaa8.chunk.js.map